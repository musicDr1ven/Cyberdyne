{"ts":1401166716514,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"module.exports = function(_, machina, Monologue, io) {\n\treturn machina.Fsm.extend( _.extend({\n\n\t\tinitialize: function() {\n\t\t\tthis.batch = [];\n\t\t\tthis.goLocal({\n\t\t\t\t\"search batch.results\"               : \"send\",\n\t\t\t\t\"language-stats percent.by.language\" : \"send\",\n\t\t\t\t\"hashtag-stats count.by.hashtag\"     : \"send\",\n\t\t\t\t\"search start\"                       : \"purge\",\n\t\t\t\t\"search stop\"                        : \"purge\"\n\t\t\t});\n\t\t},\n\n\t\tinitialState: \"queueing\",\n\n\t\t\"*\" : function() {\n\t\t\tthis.deferUntilTransition();\n\t\t},\n\n\t\tstates: {\n\t\t\tqueueing: {\n\t\t\t\t_onEnter: function() {\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tself.batch = [];\n\t\t\t\t\tself.timer = setTimeout(function(){\n\t\t\t\t\t\tself.handle(\"queue.timeout\");\n\t\t\t\t\t}, self.interval || 10000);\n\t\t\t\t},\n\t\t\t\t\"queue.timeout\" : \"transmitting\",\n\t\t\t\tsend: function(envelope) {\n\t\t\t\t\tthis.batch.push(envelope);\n\t\t\t\t},\n\t\t\t\t_onExit: function() {\n\t\t\t\t\tclearTimeout(this.timer);\n\t\t\t\t}\n\t\t\t},\n\t\t\ttransmitting: {\n\t\t\t\t_onEnter: function() {\n\t\t\t\t\tif(this.batch.length) {\n\t\t\t\t\t\tio.sockets.emit( \"postal.batch\", this.batch );\n\t\t\t\t\t}\n\t\t\t\t\tthis.transition(\"queueing\");\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tsend : function(data, envelope) {\n\t\t\tthis.handle(\"send\", envelope);\n\t\t},\n\n\t\tpurge: function() {\n\t\t\tthis.batch = [];\n\t\t}\n\n\t}, Monologue.prototype));\n};"]],"start1":0,"start2":0,"length1":0,"length2":1247}]],"length":1247}
